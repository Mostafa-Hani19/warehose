<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        .animate-float {
            animation: float 4s ease-in-out infinite;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .info-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .btn-check {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(102, 126, 234, 0.5);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    
    <div class="w-full max-w-4xl mx-auto">
        <div class="glass-card rounded-3xl p-6 md:p-8">
            <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± -->
            <div class="relative mb-6">
                <div class="w-24 h-24 mx-auto relative">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-200 to-pink-200 rounded-full animate-pulse-glow"></div>
                    <div class="absolute inset-2 bg-white rounded-full flex items-center justify-center shadow-xl">
                        <i class="fas fa-hourglass-half text-4xl bg-gradient-to-br from-purple-600 to-pink-600 bg-clip-text text-transparent animate-pulse-glow"></i>
                    </div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
            <div class="text-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold mb-2">
                    <span class="bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                    </span>
                </h1>
                <p class="text-gray-600 text-sm">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</p>
            </div>
            
            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl p-4 mb-6">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-info-circle text-white text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-1">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                        <p class="text-gray-700 text-sm leading-relaxed">
                            ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù‚Ø¨Ù„ Ø£Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù….
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© -->
            <div class="grid md:grid-cols-3 gap-3 mb-6">
                <div class="info-card bg-white rounded-xl p-4 border border-gray-100 transition-all">
                    <div class="flex items-start gap-2">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-900 text-sm mb-0.5">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ</h4>
                            <p class="text-xs text-gray-600">Ø³ÙŠØªÙ„Ù‚Ù‰ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø±Ø§Ù‹ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„</p>
                        </div>
                    </div>
                </div>
                
                <div class="info-card bg-white rounded-xl p-4 border border-gray-100 transition-all">
                    <div class="flex items-start gap-2">
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-clock text-blue-600"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-900 text-sm mb-0.5">ÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h4>
                            <p class="text-xs text-gray-600">Ø¹Ø§Ø¯Ø© 24-48 Ø³Ø§Ø¹Ø©</p>
                        </div>
                    </div>
                </div>
                
                <div class="info-card bg-white rounded-xl p-4 border border-gray-100 transition-all">
                    <div class="flex items-start gap-2">
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-bell text-purple-600"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-900 text-sm mb-0.5">Ø³Ù†Ø¨Ù„ØºÙƒ Ø¨Ø§Ù„Ù†ØªÙŠØ¬Ø©</h4>
                            <p class="text-xs text-gray-600">Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="flex flex-col sm:flex-row gap-3 mb-5">
                <button onclick="checkApprovalStatus()" 
                        class="flex-1 btn-check text-white px-6 py-3 rounded-xl font-bold transition-all">
                    <i class="fas fa-sync-alt ml-2"></i>
                    Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©
                </button>
                
                <a href="login.html" 
                   class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 px-6 py-3 rounded-xl font-bold transition-all text-center border-2 border-gray-200">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </a>
            </div>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
            <div class="text-center pt-4 border-t-2 border-gray-100">
                <p class="text-gray-600 text-sm mb-1">
                    <i class="fas fa-question-circle ml-1 text-purple-600"></i>
                    Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ
                </p>
                <a href="mailto:support@pharmacy-system.com" 
                   class="text-purple-600 hover:text-purple-800 font-bold transition-colors inline-flex items-center gap-2">
                    <i class="fas fa-envelope"></i>
                    ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
                </a>
            </div>
        </div>
        
        <!-- Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± -->
        <div class="text-center mt-4">
            <p class="text-white text-xs font-medium drop-shadow-lg">
                Â© 2024 Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/supabase-integration.js"></script>
    <script>
        if (typeof initSupabaseClient === 'function') {
            initSupabaseClient();
        }
        
        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
        const user = getCurrentUser();
        
        if (user && user.id) {
            const client = getSupabaseClient();
            
            // 1. Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Realtime Updates
            if (client) {
                const subscription = client
                    .channel(`user-approval-pending-${user.id}`)
                    .on(
                        'postgres_changes',
                        {
                            event: 'UPDATE',
                            schema: 'public',
                            table: 'users',
                            filter: `id=eq.${user.id}`
                        },
                        (payload) => {
                            console.log('ğŸ”” ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', payload);
                            
                            // Ø¥Ø°Ø§ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                            if (payload.new && payload.new.is_approved === true) {
                                console.log('âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ!');
                                
                                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                                const currentUser = getCurrentUser();
                                if (currentUser) {
                                    currentUser.is_approved = true;
                                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                                }
                                
                                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
                                alert('ğŸ‰ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ ...');
                                
                                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…
                                window.location.href = 'index.html';
                            }
                        }
                    )
                    .subscribe((status) => {
                        if (status === 'SUBSCRIBED') {
                            console.log('âœ… ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (ÙÙˆØ±ÙŠ)');
                        } else if (status === 'CHANNEL_ERROR') {
                            console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ RealtimeØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                        }
                    });
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
                window.addEventListener('beforeunload', () => {
                    if (subscription) {
                        client.removeChannel(subscription);
                    }
                });
            }
            
            // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙƒØ¨Ø¯ÙŠÙ„ (ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©)
            setInterval(async function() {
                if (!client) return;
                
                try {
                    const { data, error } = await client
                        .from('users')
                        .select('is_approved')
                        .eq('id', user.id)
                        .single();
                    
                    if (error) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚:', error);
                        return;
                    }
                    
                    if (data && data.is_approved === true) {
                        console.log('âœ… ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø¨Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠ');
                        
                        const currentUser = getCurrentUser();
                        if (currentUser) {
                            currentUser.is_approved = true;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        }
                        
                        alert('ğŸ‰ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...');
                        window.location.href = 'index.html';
                    }
                } catch (err) {
                    console.error('âŒ Ø®Ø·Ø£:', err);
                }
            }, 15000);
            
            console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (ÙÙˆØ±ÙŠ + Ø¯ÙˆØ±ÙŠ)');
        }
        
        // Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙŠØ¯ÙˆÙŠ
        async function checkApprovalStatus() {
            const button = event.target; 
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            const user = getCurrentUser();
            
            if (!user) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                window.location.href = 'login.html';
                return;
            }
            
            if (typeof getSupabaseClient === 'function') {
                const client = getSupabaseClient();
                
                try {
                    const { data, error } = await client
                        .from('users')
                        .select('is_approved')
                        .eq('id', user.id)
                        .single();
                    
                    if (error) throw error;
                    
                    if (data && data.is_approved) {
                        user.is_approved = true;
                        localStorage.setItem('currentUser', JSON.stringify(user));
                        alert('ğŸ‰ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...');
                        window.location.href = 'index.html';
                    } else {
                        alert('Ø­Ø³Ø§Ø¨Ùƒ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©');
                }
            }
            
            button.disabled = false;
            button.innerHTML = originalText;
        }
    </script>
</body>
</html>
